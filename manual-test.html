<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TTS Voice Bridge - Manual Test</title>
    <link rel="stylesheet" href="popup.css" />
    <style>
      body {
        padding: 20px;
        background: #f0f0f0;
      }
      .test-container {
        max-width: 400px;
        margin: 0 auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .test-header {
        background: #1a73e8;
        color: white;
        padding: 16px;
        text-align: center;
      }
      .test-log {
        margin-top: 20px;
        padding: 16px;
        background: #f8f9fa;
        border-radius: 8px;
        font-family: monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <div class="test-header">
        <h2>TTS Voice Bridge - Manual Test</h2>
        <p>Test the popup UI functionality</p>
      </div>

      <!-- Include the popup HTML content -->
      <div class="container">
        <header>
          <h1>TTS Voice Bridge</h1>
        </header>

        <main>
          <div class="input-section">
            <textarea
              id="textInput"
              placeholder="Î≥ÄÌôòÌï† ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."
              rows="4"
              maxlength="1000"
              aria-label="TTS Î≥ÄÌôòÌï† ÌÖçÏä§Ìä∏ ÏûÖÎ†•"
            ></textarea>
            <div class="character-count">
              <span id="charCount">0</span>/1000
            </div>
          </div>

          <div class="controls">
            <button
              id="playButton"
              class="primary-button"
              disabled
              aria-label="ÌÖçÏä§Ìä∏Î•º ÏùåÏÑ±ÏúºÎ°ú Î≥ÄÌôòÌïòÏó¨ Ïû¨ÏÉù"
            >
              <span class="button-text">ÏùåÏÑ± Ïû¨ÏÉù</span>
              <span class="loading-spinner" style="display: none"></span>
            </button>

            <button
              id="stopButton"
              class="secondary-button"
              style="display: none"
              aria-label="ÏùåÏÑ± Ïû¨ÏÉù Ï†ïÏßÄ"
            >
              Ï†ïÏßÄ
            </button>
            <button
              id="settingsButton"
              class="secondary-button"
              aria-label="TTS ÏÑ§Ï†ï Ïó¥Í∏∞"
            >
              ÏÑ§Ï†ï
            </button>
          </div>

          <div
            class="progress-section"
            id="progressSection"
            style="display: none"
          >
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Ïû¨ÏÉù Ï§ë...</div>
          </div>

          <div class="status" id="statusIndicator">
            <span class="status-text">Ï§ÄÎπÑÎê®</span>
          </div>

          <div class="shortcuts-hint">
            <small>ÌåÅ: Enter ÌÇ§Î°ú Îπ†Î•∏ Ïã§Ìñâ</small>
          </div>
        </main>
      </div>
    </div>

    <div class="test-log" id="testLog">
      <strong>Test Log:</strong><br />
      Page loaded successfully.<br />
    </div>

    <script>
      // Mock Chrome APIs for testing
      window.chrome = {
        runtime: {
          sendMessage: async (message) => {
            log(`üì§ Sent message: ${message.type}`);

            // Simulate different responses based on message type
            if (message.type === "TTS_PLAY") {
              // Simulate successful start
              setTimeout(() => {
                simulateMessage("TTS_STARTED", {});
              }, 100);

              // Simulate progress updates
              let progress = 0;
              const progressInterval = setInterval(() => {
                progress += 25;
                simulateMessage("TTS_PROGRESS", {
                  progress,
                  currentWord: `word${progress / 25}`,
                });

                if (progress >= 100) {
                  clearInterval(progressInterval);
                  setTimeout(() => {
                    simulateMessage("TTS_COMPLETED", {});
                  }, 500);
                }
              }, 500);

              return { success: true };
            } else if (message.type === "TTS_STOP") {
              setTimeout(() => {
                simulateMessage("TTS_STOPPED", {});
              }, 100);
              return { success: true };
            }

            return { success: true };
          },
          onMessage: {
            addListener: (listener) => {
              window.messageListeners = window.messageListeners || [];
              window.messageListeners.push(listener);
              log("üì• Message listener added");
            },
          },
          getURL: (path) => `./${path}`,
        },
        storage: {
          local: {
            set: async (data) => {
              localStorage.setItem("tts-test", JSON.stringify(data));
              log(`üíæ Saved to storage: ${Object.keys(data).join(", ")}`);
            },
            get: async (keys) => {
              const stored = localStorage.getItem("tts-test");
              const data = stored ? JSON.parse(stored) : {};
              log(`üìñ Loaded from storage: ${keys.join(", ")}`);
              return data;
            },
          },
        },
        tabs: {
          create: async (options) => {
            log(`üîó Would open tab: ${options.url}`);
            alert(`Would open settings page: ${options.url}`);
            return { id: 1 };
          },
        },
      };

      function log(message) {
        const logElement = document.getElementById("testLog");
        const timestamp = new Date().toLocaleTimeString();
        logElement.innerHTML += `[${timestamp}] ${message}<br>`;
        logElement.scrollTop = logElement.scrollHeight;
      }

      function simulateMessage(type, payload) {
        log(`üì® Simulating message: ${type}`);
        if (window.messageListeners) {
          window.messageListeners.forEach((listener) => {
            listener({ type, payload, timestamp: Date.now() }, {}, () => {});
          });
        }
      }

      // Test the popup functionality
      log("Initializing popup UI...");
    </script>
    <script src="popup.js"></script>
    <script>
      // Additional test functionality
      document.addEventListener("DOMContentLoaded", () => {
        log("‚úÖ Popup UI initialized successfully");

        // Test character counting
        const textInput = document.getElementById("textInput");
        textInput.addEventListener("input", () => {
          log(`üìù Text length: ${textInput.value.length}`);
        });

        // Test button states
        const playButton = document.getElementById("playButton");
        const observer = new MutationObserver(() => {
          log(`üîò Play button disabled: ${playButton.disabled}`);
        });
        observer.observe(playButton, {
          attributes: true,
          attributeFilter: ["disabled"],
        });
      });
    </script>
  </body>
</html>
